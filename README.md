# 南京景区多源数据聚类与情感关联分析
## 一、项目简介
本项目为“大数据系统原理与应用”课程作业，聚焦南京城市文旅场景，以119个景区为研究对象，整合微博签到文本、景区POI（兴趣点）及气象三类多源数据，通过情感分析、K-means聚类、LDA主题建模及统计检验等方法，系统探究“天气-景区类型-游客情感”的内在关联机制，最终形成可支撑城市文旅资源管理的实证结论。

项目核心价值在于将非结构化的游客文本反馈转化为量化情感特征，结合空间与气象数据揭示景区运营的隐性规律，核心成果包括6类景区聚类划分、4个情感主题提取、天气对情感的类型特异性影响结论，所有代码、原始数据、处理后数据及可视化结果均已开源，可直接用于课程作业复现与后续研究拓展。


## 二、环境配置
### 1. 基础环境要求
- 操作系统：Windows 10/11（推荐）、macOS 12.0+、Linux（Ubuntu 20.04 LTS）
- Python版本：3.8-3.10（建议使用3.9版本，避免高版本对部分库的兼容性问题）
- 额外工具（可选）：QGIS 3.28.1（用于空间数据提取与可视化，若仅运行代码无需安装）

### 2. 依赖库安装说明
仓库根目录已提供`requirements.txt`文件，包含所有代码运行所需依赖，执行以下命令即可一键安装：
```bash
pip install -r requirements.txt
```
`requirements.txt`完整内容如下：
```
pandas==1.5.3
numpy==1.24.3
scikit-learn==1.3.0
matplotlib==3.7.1
seaborn==0.12.2
gensim==4.3.1
jieba==0.42.1
requests==2.31.0
python-dotenv==1.0.0
pillow==10.0.1
openpyxl==3.1.2
```


## 三、文件结构说明
仓库文件按“数据-代码-结果”逻辑划分，便于快速定位核心内容，具体结构如下：
```
南京景区多源数据聚类与情感关联分析/
├─ data/                # 数据存储目录（含原始数据与处理后数据）
│  ├─ raw_data/         # 原始数据（未经处理，保持获取时格式）
│  │  ├─ weibo_checkin.csv  # 微博签到数据（字段：用户ID、评论文本、签到时间、经纬度）
│  │  ├─ nanjing_poi.csv    # 南京景区POI数据（字段：景区名称、经度、纬度、一级标签、二级标签）
│  │  └─ nanjing_weather.csv # 南京气象数据（2023年11月，字段：日期、天气类型、能见度、降水情况）
│  └─ processed_data/   # 代码处理后生成的数据（可直接用于分析）
│     ├─ cleaned_data.csv    # 预处理后总数据集（空间关联+时序匹配，含所有核心字段）
│     ├─ sentiment_results.csv  # 情感分析结果（字段：景区名称、评论文本、情感极性、情感强度、情绪类别）
│     └─ cluster_results.csv    # 聚类结果（字段：景区名称、聚类标签、平均情感得分、景区类型、经纬度）
├─ code/                # 核心代码目录（按功能模块拆分，含详细注释）
│  ├─ 01_sentiment_analysis.py  # 情感分析（调用DeepSeek API生成结构化情感特征）
│  ├─ 02_kmeans_clustering.py   # K-means聚类（最优簇数计算、PCA降维、结果可视化）
│  ├─ 03_lda_topic_modeling.py  # LDA主题建模（文本分词、主题训练、关键词提取）
│  └─ 04_statistical_tests.py   # 统计检验（方差齐性、双向方差分析、相关性分析）
├─ results/             # 结果输出目录（可视化图表与分析报告）
│  ├─ figures/          # 可视化图表（按分析类型分类）
│  │  ├─ clustering/    # 聚类相关图表（轮廓系数图、PCA降维散点图）
│  │  └─ sentiment/     # 情感相关图表（天气-情感热力图、情感类型占比图）
│  │ 
│  c final_report.pdf  # 完整分析报告（与课程作业提交报告一致，含核心结论与图表解读）
├─ requirements.txt     # 环境依赖配置文件
└─ README.md            # 项目说明文档（本文件）
```


## 四、代码运行步骤
代码需按以下顺序执行，确保数据流转与依赖关系正确，关键步骤已标注注意事项：

### 1. 情感分析（需配置API密钥）
- 执行文件：`code/02_sentiment_analysis.py`
- 核心功能：对预处理后的微博文本进行情感极性（正向/负向）、强度（0-10分）、具体情绪类别（愉悦/怀旧等）提取。
- 输出结果：`data/processed_data/sentiment_results.csv`

### 2. K-means聚类分析
- 执行文件：`code/03_kmeans_clustering.py`
- 核心功能：
  1. 特征处理：对景区经纬度、平均情感得分、类型标签进行标准化与独热编码；
  2. 最优簇数选择：计算K=2至K=10的轮廓系数，自动选择最高系数对应的K值（本项目K=6）；
  3. 可视化：通过PCA将高维特征降维至二维，生成聚类散点图（保存至`results/figures/clustering/`）。
- 输出结果：`data/processed_data/cluster_results.csv`、轮廓系数图、PCA聚类散点图

### 3. LDA主题建模
- 执行文件：`code/04_lda_topic_modeling.py`
- 核心功能：
  1. 文本预处理：使用jieba分词，过滤停用词（如“的”“了”）与无意义词汇；
  2. 模型训练：设置主题数为4，迭代100次训练LDA模型，输出各主题Top10关键词；
  3. 结果可视化：生成主题词云图与主题在各景区类型中的分布热力图。
- 输出结果：主题-关键词对照表（控制台打印）、主题词云图、主题分布热力图（保存至`results/figures/lda/`）

### 4. 统计检验
- 执行文件：`code/05_statistical_tests.py`
- 核心功能：
  1. 方差齐性检验：验证不同天气类型下情感得分的方差齐性（本项目p=0.1548，满足齐性）；
  2. 双向方差分析：检验景区类型、天气类型及两者交互效应对情感得分的影响；
  3. 相关性分析：计算不同景区类型中能见度、降水与情感的相关系数。
- 输出结果：统计检验报告（控制台打印+保存为`results/statistical_report.txt`）


## 五、核心成果说明
### 1. 数据成果
- 结构化情感数据集：`sentiment_results.csv`含1200+条微博文本的情感特征，可直接用于情感与天气、景区类型的关联分析；
- 景区聚类数据集：`cluster_results.csv`明确6类景区的核心特征（如“城市休闲游憩类”平均情感得分3.12，“核心文化古迹类”含35个景区），为文旅分类管理提供依据。

### 2. 代码成果
- 模块化设计：各代码文件独立实现单一功能，可单独复用（如`02_sentiment_analysis.py`可修改后用于其他文本的情感分析）；
- 详细注释：关键步骤标注逻辑说明（如聚类代码中解释“选择K=6的原因”，预处理代码标注“坐标转换的必要性”），便于理解与修改。

### 3. 可视化与报告成果
- 可视化图表：`results/figures/`含15张核心图表，涵盖聚类分布、天气-情感关联、主题特征等，所有图表均标注坐标轴含义与核心结论；
- 分析报告：`results/final_report.pdf`共18页，包含研究背景、数据方法、结果分析、实践启示等，与课程作业提交要求完全匹配，可直接作为作业报告参考。


## 六、注意事项
1. API调用问题：若DeepSeek API调用超时或报错，可检查`.env`文件中密钥是否正确，或切换至本地TextBlob模型（代码已预留备用逻辑，无需额外安装依赖）；
2. 数据路径问题：代码中所有文件路径均为相对路径，无需修改即可运行，若提示“文件不存在”，需确认`data/raw_data/`下原始数据是否完整；
3. 运行时间说明：情感分析（1200条文本）约5-8分钟，LDA建模（迭代100次）约3-5分钟，建议保持网络稳定，避免中途中断；
4. 环境冲突解决：若安装依赖时出现版本冲突，可执行`pip install --upgrade pip`更新pip后重新安装，或单独安装冲突库（如`pip install pandas==1.5.3`）。


## 七、姓名
- 姓名：周千雯 魏来
- 学号：231820299 231820102
- 课程：大数据系统原理与应用
