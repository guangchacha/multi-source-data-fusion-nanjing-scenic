# 南京景区多源数据聚类与情感关联分析
## 一、项目简介
本项目为“大数据系统原理与应用”课程作业，聚焦南京城市文旅场景，以119个景区为研究对象，整合微博签到文本、景区POI（兴趣点）及气象三类多源数据，通过情感分析、K-means聚类、LDA主题建模及统计检验等方法，系统探究“天气-景区类型-游客情感”的内在关联机制，最终形成可支撑城市文旅资源管理的实证结论。

项目核心价值在于将非结构化的游客文本反馈转化为量化情感特征，结合空间与气象数据揭示景区运营的隐性规律，核心成果包括6类景区聚类划分、4个情感主题提取、天气对情感的类型特异性影响结论，所有代码、原始数据、处理后数据及可视化结果均已开源，可直接用于课程作业复现与后续研究拓展。


## 二、环境配置
### 1. 基础环境要求
- 操作系统：Windows 10/11（推荐）、macOS 12.0+、Linux（Ubuntu 20.04 LTS）
- Python版本：3.8-3.10（建议使用3.9版本，避免高版本对部分库的兼容性问题）
- 额外工具（可选）：QGIS 3.28.1（用于空间数据提取与可视化，若仅运行代码无需安装）

### 2. 依赖库安装说明
仓库根目录已提供`requirements.txt`文件，包含所有代码运行所需依赖，执行以下命令即可一键安装：
```bash
pip install -r requirements.txt
```
`requirements.txt`完整内容如下：
```
pandas==1.5.3
numpy==1.24.3
scikit-learn==1.3.0
matplotlib==3.7.1
seaborn==0.12.2
gensim==4.3.1
jieba==0.42.1
requests==2.31.0
python-dotenv==1.0.0
pillow==10.0.1
openpyxl==3.1.2
scipy==1.10.1        
tqdm==4.67.1      
plotly==6.3.1        
wordcloud==1.9.2      
statsmodels==0.14.0    
dash==3.2.0          
dash-bootstrap-components==2.0.4  
requests==2.32.5    
```


## 三、文件结构说明
仓库文件按“数据-代码-结果”逻辑划分，便于快速定位核心内容，具体结构如下：
```
南京景区多源数据聚类与情感关联分析/
├─ data/                # 数据存储目录（含原始数据与处理后数据）
│  ├─ raw_data/         # 原始数据（未经处理，保持获取时格式）
│  │  ├─ 南京市_20231114_1119.csv  # 微博签到数据（字段：用户ID、评论文本、签到时间、经纬度）
│  │  └─ nanjing_Aoi.shp    # 南京景区POI数据（字段：景区名称、经度、纬度、一级标签、二级标签）
│  └─ processed_data/   # 代码处理后生成的数据（可直接用于分析）
│     ├─ 南京景区-天气-社媒情感融合表.csv    # 预处理后总数据集（空间关联+时序匹配，含所有核心字段）
│     ├─ 情感分析结果（限制情感大类）.csv  # 情感分析结果（字段：景区名称、评论文本、情感极性、情感强度、情绪类别）
│     └─ 景区聚类结果.csv    # 聚类结果（字段：景区名称、聚类标签、平均情感得分、景区类型、经纬度）
├─ code/                # 核心代码目录（按功能模块拆分，含详细注释）
│  ├─ 01_ds情感分析.py  # 情感分析（调用DeepSeek API生成结构化情感特征，无法直接使用，需要申请自己的API）
│  ├─ 02_景区聚类.py   # K-means聚类（最优簇数计算、PCA降维、结果可视化）
│  ├─ 03_lda_cuda.ipynb  # LDA主题建模（文本分词、主题训练、关键词提取）
│  └─ 04_描述性统计及统计检验.py   # 统计检验（方差齐性、双向方差分析、相关性分析）
├─ results/             # 结果输出目录（可视化图表与分析报告）
│  ├─ figures/          # 可视化图表
│  └─ 可视化dash网页
│     ├─ app.py   #运行该脚本即可查看dash动态化数据表盘
│     ├─ pages/          # 存放dash网页页面代码（如map_view.py）
│     └─ assets/  #存放静态资源文件夹（图片、css样式等）
├─ 实验报告-基于多源数据融合的城市景点资源分析.pdf  # 完整分析报告（与课程作业提交报告一致，含核心结论与图表解读）
├─ requirements.txt     # 环境依赖配置文件
└─ README.md            # 项目说明文档（本文件）
```


## 四、代码运行步骤
代码需按以下顺序执行，确保数据流转与依赖关系正确，关键步骤已标注注意事项：

### 1. 情感分析（需配置API密钥）
- 执行文件
- 核心功能：对预处理后的微博文本进行情感极性（正向/负向）、强度（0-10分）、具体情绪类别（愉悦/怀旧等）提取。
- 输出结果：`data/processed_data/sentiment_results.csv`

### 2. K-means聚类分析
- 执行文件：景区聚类.py 
- 核心功能：
  1. 特征处理：对景区经纬度、平均情感得分、类型标签进行标准化与独热编码；
  2. 最优簇数选择：计算K=2至K=10的轮廓系数，自动选择最高系数对应的K值（本项目K=6）；
  3. 可视化：通过PCA将高维特征降维至二维，生成聚类散点图（保存至`results/figures/clustering/`）。
- 输出结果：`data/processed_data/cluster_results.csv`、轮廓系数图、PCA聚类散点图

### 3. LDA主题建模
- 执行文件：lda_cuda.ipynb 
- 核心功能：
  1. 文本预处理：使用jieba分词，过滤停用词（如“的”“了”）与无意义词汇；
  2. 模型训练：设置主题数为4，迭代100次训练LDA模型，输出各主题Top10关键词；
  3. 结果可视化：生成主题词云图与主题在各景区类型中的分布热力图。
- 输出结果：主题-关键词对照表（控制台打印）、主题词云图、主题分布热力图（保存至`results/figures/lda/`）

### 4. 统计检验
- 执行文件：描述性统计及统计检验.py
- 核心功能：
  1. 方差齐性检验：验证不同天气类型下情感得分的方差齐性（本项目p=0.1548，满足齐性）；
  2. 双向方差分析：检验景区类型、天气类型及两者交互效应对情感得分的影响；
  3. 相关性分析：计算不同景区类型中能见度、降水与情感的相关系数。
- 输出结果：统计检验报告（控制台打印+保存为`results/statistical_report.txt`）

## 五、可视化网页使用指南

- 本项目提供基于 Dash 框架 构建的交互式可视化网页，整合静态图表与交互式仪表盘，便于从多维角度探索南京景区的情感与气象特征。

### 1. 启动方式

- 在命令行终端进入项目根目录，执行以下命令启动本地服务器：

```bash
results/可视化dash网页/app.py
```

- 程序运行后，终端会显示类似提示：

```bash
Dash is running on http://127.0.0.1:8050/
```
- 在浏览器中输入该地址即可访问可视化系统主页。

### 2. 网页结构说明

- 网页采用多页面结构，使用 Dash 的 register_page() 模块自动注册，导航栏可在不同分析模块间切换，主要包括：
- 首页（Home）：展示项目简介与整体框架；
- 情绪分析页面（/emotion_view）：展示微博文本中不同情绪类型（愉悦、怀旧、烦恼、悲伤等）的强度、分布及景区差异；
- 气象与情感分析页面（/weather_view）：展示降水、能见度、天气类型等对情感变化的影响，包括热力图、箱线图及情感强度三维交叉结果。
- 每个页面下方均提供核心图表（PNG 格式），支持放大查看与对比分析。

### 3. 文件路径与静态资源

- 网页所需图片均保存在以下目录，可根据需要替换或更新：
```bash
assets/可视化图片/
```

- 静态样式表（style.css）位于 assets/ 目录下，控制两栏图表排版与全局样式。

### 4. 输出与展示

- 静态PNG图表：位于 /assets/可视化图片/，展示情感类型分布与气象对比结果；

- 交互式仪表盘（HTML）：由 Dash 动态渲染，实时加载图表与文字说明；

- 操作说明视频（MP4）：存放于 /results/figures/ 目录，用于课程展示演示（可选项）。

- 网页界面采用响应式设计，可在电脑端和大屏端平滑展示。


## 六、核心成果说明
### 1. 数据成果
- 结构化情感数据集：南京景区-天气-社媒情感融合表.csv含大量微博文本的情感特征，可直接用于情感与天气、景区类型的关联分析；
- 景区聚类数据集：景区聚类结果.csv 明确6类景区的核心特征，为文旅分类管理提供依据。

### 2. 代码成果
- 模块化设计：各代码文件独立实现单一功能，可单独复用）；
- 详细注释：关键步骤标注逻辑说明，便于理解与修改。

### 3. 可视化与报告成果
- 可视化图表：`results/figures/`多5张核心图表，涵盖聚类分布、天气-情感关联、主题特征等，所有图表均标注坐标轴含义与核心结论；
- 分析报告：`results/final_report.pdf'包含研究背景、数据方法、结果分析、实践启示等，与课程作业提交要求完全匹配，可直接作为作业报告参考。


## 七、注意事项
1. 数据路径问题：代码中所有文件路径均为相对路径，无需修改即可运行，若提示“文件不存在”，需确认`data/raw_data/`下原始数据是否完整；
2. 运行时间说明：情感分析耗时较长，建议保持网络稳定，避免中途中断；
3. 环境冲突解决：若安装依赖时出现版本冲突，可执行`pip install --upgrade pip`更新pip后重新安装，或单独安装冲突库（如`pip install pandas==1.5.3`）。


## 八、姓名
- 姓名：周千雯 魏来
- 学号：231820299 231820102
- 课程：大数据系统原理与应用
